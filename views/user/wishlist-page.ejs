<%- include("../partials/user/user-header") %>
    <main class="main">
       
        <section class="mt-50 mb-50">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table shopping-summery text-center" id="wishlistTable">
                                <thead>
                                    <tr class="main-heading">
                                        <th scope="col">Product</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Price</th>
                                        <th scope="col">Stock Status</th>
                                        <th scope="col">Action</th>
                                        <th scope="col">Remove</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for( let i = 0; i < products.length; i++ ) { %>
                                    
                                   
                                    <tr>
                                        <td class="image product-thumbnail"><img src="/public/uploads/<%= products[i].product.image[0] %>" alt="#"></td>
                                        <td class="product-des product-name">
                                            <h5 class="product-name"><a href="shop-product-right.html"><%= products[i].product.product_name %></a></h5>
                                            
                                        </td>
                                        <td class="price" data-title="Price"><span>$<%= products[i].product.offerPrice %></span></td>
                                        <td class="text-center" data-title="Stock">
                                            <% if (products[i].product.total_quantity >= 1) { %>
                                                <span class="color3 font-weight-bold" style="color: green;">In Stock</span>
                                            <% } else { %>
                                                <span class="color3 font-weight-bold" style="color: red;">Out Of Stock</span>
                                            <% } %>
                                        </td>
                                        
                                        <td class="text-right" data-title="Cart">
                                            <% if (products[i].isCart) { %>
                                                
                                                <!-- <a href="#" class="btn btn-sm">
                                                    <i class="fi-rs-shopping-bag mr-5"></i>Contact Us
                                                </a> -->
                                                <a  onclick="cartAdd('<%= products[i].product._id %>')" class="btn btn-sm">
                                                    <i class="fi-rs-shopping-bag mr-5"></i>Add to cart
                                                </a>
                                                
                                            <% } else { %>
                                                <a  onclick="cartAdd('<%= products[i].product._id %>')" class="btn btn-sm">
                                                    <i class="fi-rs-shopping-bag mr-5"></i>Add to cart
                                                </a>
                                                
                                                
                                            <% } %>
                                            
                                        </td>
                                        <td>
                                        <a onclick="removeFromWishlist('<%= products[i].product._id %>')" class="text-muted"
                                            ><i class="fi-rs-trash"></i
                                          ></a>
                                        </td>
                                    </tr>
                                    <div class="modal fade" id="sizeModal<%= products[i].product._id %>" tabindex="-1" role="dialog" aria-labelledby="sizeModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="sizeModalLabel">Select Size</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body text-center">
                                                    <div class="attr-detail attr-size btn-group d-flex justify-content-center"> <!-- Added d-flex and justify-content-center -->
                                                        
                                                        <ul class="list-filter size-filter font-small">
                                                            <li><a href="#" id="smallQuantits">S</a></li>
                                                            <li class="active"><a href="#" id="mediumQuantits">M</a></li>
                                                            <li><a href="#" id="largeQuantits">L</a></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <span class="text-center" id="displayMessage<%= products[i].product._id %>"></span>
                                                <div class="text-center mt-3">
                                                    <div class="d-inline-block">
                                                        <button class="btn btn-sm btn-primary" id="addButton<%= products[i].product._id %>" style="width: 200px; margin-bottom: 30px; background-color: rgb(85, 172, 143); color: white;" onclick="addToCarts('<%= products[i].product._id %>')">Add</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <% } %>
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
        </section>
    </main>
    <footer class="main">
        <section class="newsletter p-30 text-white wow fadeIn animated">
          
        </section>
        <section class="section-padding footer-mid">
          <div class="container pt-15 pb-20">
            <div class="row">
              <div class="col-lg-4 col-md-6">
                <div class="widget-about font-md mb-md-5 mb-lg-0">
                  
                  <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">
                    Contact
                  </h5>
                  <p class="wow fadeIn animated">
                    <strong>Address: </strong>562 Wellington Road, Street 32, San
                    Francisco
                  </p>
                  <p class="wow fadeIn animated">
                    <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                  </p>
                  <p class="wow fadeIn animated">
                    <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                  </p>
                  <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">
                    Follow Us
                  </h5>
                  <div
                    class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0"
                  >
                    <a href="#"
                      ><img
                        src="/public/user/assets/imgs/theme/icons/icon-facebook.svg"
                        alt=""
                    /></a>
                    <a href="#"
                      ><img
                        src="/public/user/assets/imgs/theme/icons/icon-twitter.svg"
                        alt=""
                    /></a>
                    <a href="#"
                      ><img
                        src="/public/user/assets/imgs/theme/icons/icon-instagram.svg"
                        alt=""
                    /></a>
                    <a href="#"
                      ><img
                        src="/public/user/assets/imgs/theme/icons/icon-pinterest.svg"
                        alt=""
                    /></a>
                    <a href="#"
                      ><img
                        src="/public/user/assets/imgs/theme/icons/icon-youtube.svg"
                        alt=""
                    /></a>
                  </div>
                </div>
              </div>
              <div class="col-lg-2 col-md-3">
                <h5 class="widget-title wow fadeIn animated">About</h5>
                <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                  <li><a href="#">About Us</a></li>
                  <li><a href="#">Delivery Information</a></li>
                  <li><a href="#">Privacy Policy</a></li>
                  <li><a href="#">Terms &amp; Conditions</a></li>
                  <li><a href="#">Contact Us</a></li>
                  <li><a href="#">Support Center</a></li>
                </ul>
              </div>
              <div class="col-lg-2 col-md-3">
                <h5 class="widget-title wow fadeIn animated">My Account</h5>
                <ul class="footer-list wow fadeIn animated">
                  <li><a href="#">Sign In</a></li>
                  <li><a href="#">View Cart</a></li>
                  <li><a href="#">My Wishlist</a></li>
                  <li><a href="#">Track My Order</a></li>
                  <li><a href="#">Help</a></li>
                  <li><a href="#">Order</a></li>
                </ul>
              </div>
              <div class="col-lg-4">
                <h5 class="widget-title wow fadeIn animated">Install App</h5>
                <div class="row">
                  <div class="col-md-8 col-lg-12">
                    <p class="wow fadeIn animated">
                      From App Store or Google Play
                    </p>
                    <div class="download-app wow fadeIn animated">
                      <a href="#" class="hover-up mb-sm-4 mb-lg-0"
                        ><img
                          class="active"
                          src="/public/user/assets/imgs/theme/app-store.jpg"
                          alt=""
                      /></a>
                      <a href="#" class="hover-up"
                        ><img
                          src="/public/user/assets/imgs/theme/google-play.jpg"
                          alt=""
                      /></a>
                    </div>
                  </div>
                  <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                    <p class="mb-20 wow fadeIn animated">
                      Secured Payment Gateways
                    </p>
                    <img
                      class="wow fadeIn animated"
                      src="/public/user/assets/imgs/theme/payment-method.png"
                      alt=""
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        
      </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Vendor JS-->
    <script src="/public/user/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="/public/user/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="/public/user/assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="/public/user/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="/public/user/assets/js/plugins/slick.js"></script>
    <script src="/public/user/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="/public/user/assets/js/plugins/wow.js"></script>
    <script src="/public/user/assets/js/plugins/jquery-ui.js"></script>
    <script src="/public/user/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="/public/user/assets/js/plugins/magnific-popup.js"></script>
    <script src="/public/user/assets/js/plugins/select2.min.js"></script>
    <script src="/public/user/assets/js/plugins/waypoints.js"></script>
    <script src="/public/user/assets/js/plugins/counterup.js"></script>
    <script src="/public/user/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="/public/user/assets/js/plugins/images-loaded.js"></script>
    <script src="/public/user/assets/js/plugins/isotope.js"></script>
    <script src="/public/user/assets/js/plugins/scrollup.js"></script>
    <script src="/public/user/assets/js/plugins/jquery.vticker-min.js"></script>
    <!-- Template  JS -->
    <script src="./public/user/assets/js/main.js?v=3.4"></script>
    <script src="./public/user/assets/js/shop.js?v=3.4"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script
    type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/toastify-js"
  ></script>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
  <script>
    $(document).ready(() => {
      $("#wishlistTable").DataTable();
    });
  </script>
    <script>
        const removeFromWishlist = (productId)=>{
            console.log(productId)

            swal("Are you sure you want to do this?",{
                    buttons:["NO","YES"]
                }).then((res)=>{
                    if(res){
                        $.ajax({
            url:"/removeFromWishlist/"+productId,
            method:"DELETE",
            success: function (response){
              if(response.status){
                window.location.reload();
  
              }
              else{
                window.location.reload();
              }
            }
          })

                    }
                })
          
        }
      </script>
      
      <script>
        function openSizeModal(productId) {
          $('#sizeModal'+productId).modal('show');
        }
        
        function closeSizeModal(productId) {
          $('#sizeModal' + productId).modal('hide');
        }
        
        
        function cartAdd(productId){
            console.log("productid",productId)
            console.log("clicked add to cart")
            openSizeModal(productId)
         
         
        
        
        }
    //     let selected=undefined
    //     function selectSize(size,productId){
    //         $.ajax({
    //             url:`/quantity?id=${productId}&size=${size}`,
    //             type:"POST",
    //             success:function(response){
    //                 const message=parseInt(response.message)
    //                 const displayMessage=document.getElementById("displayMessage"+productId)
    //                 const addButton=document.getElementById("addButton"+productId)
                    
    //                 console.log("message",message)
    //                 if(message==0){
    //                      Toastify({
    //                             text: `Item is out of stock`,
    //                             backgroundColor: "red",
    //                             duration: 3000,
    //                             position: "center" 
    //                         }).showToast();
    //                         displayMessage.innerText="item is out of Stock"
    //                          displayMessage.style.color="red"
    //                          addButton.disabled=true
    //                           setTimeout(()=>{
    //                             displayMessage.innerText=""
        
    //                          },3000)
        
    //                 }else{
    //                     Toastify({
    //                             text: `size selected`,
    //                             backgroundColor: "red",
    //                             duration: 3000,
    //                             position: "center" 
    //                         }).showToast();
    //                         displayMessage.innerText="item is available"
    //                         displayMessage.style.color="green"
    //                         selected=size
    //                          addButton.disabled=false
    //                          setTimeout(()=>{
    //                             displayMessage.innerText=""
        
    //                          },3000)
        
        
    //                 }
        
    //             },
    //             error:function(error){
    //                 console.log(error)
    //             }
    //         })
    //     }
    //     function addToCart(productId){
    //         let size="";
    // if(document.getElementById('smallQuantity').classList.contains('active')){
    //     size="S";
    // }
    // else if(document.getElementById('mediumQuantity').classList.contains('active')){
    //     size="M";
    // }
    // else if(document.getElementById('largeQuantity').classList.contains('active')){
    //     size="L";
    // }else{
    //     size="M";
    // }
    // console.log(size)
    //         if(selected==undefined){
    //              Toastify({
    //                             text: ` Please Select a size`,
    //                             backgroundColor: "red",
    //                             duration: 3000,
    //                             position: "center" 
    //                         }).showToast();
    //                         return
        
    //         }
    //         $.ajax({
    //              url:`/addcart?id=${productId}&size=${selected}`,
    //              type:"POST",
    //              success:function(response){
    //                 if(response.success){
    //                     console.log("inside if")
    //                     closeSizeModal(productId)
    //                       Toastify({
    //                             text: `Product added to cart`,
    //                             backgroundColor: "green",
    //                             duration: 3000,
    //                             position: "center" 
    //                         }).showToast();
    //                     const product=document.getElementById("product"+productId)
    //                     product.remove()
        
        
        
    //                 }
    //                 else{
    //                     console.log("inside else")
    //                     closeSizeModal(productId)
    //                       Toastify({
    //                             text: `Product already in cart`,
    //                             backgroundColor: "red",
    //                             duration: 3000,
    //                             position: "center" 
    //                         }).showToast();
        
    //                 }
        
    //              },
    //              error:function(error){
    //                 console.log(error)
    //              }
        
    //         })
    //     }
    //     function removeWishList(productId){
    //           swal({
    //             title: "Are you sure?",
    //             text: "Remove product from wishlist ?",
    //             icon: "warning",
    //             buttons: ["Cancel", "Yes, remove product"],
    //             dangerMode: true,
    //         }).then((confirmed) => {
    //             if (confirmed) {
    //               $.ajax({
    //             url:`/removeWishlist?id=${productId}`,
    //             type:"DELETE",
    //             success:function(response){
    //                 if(response.success){
    //                     const product=document.getElementById("product"+productId)
    //                     product.remove()
        
    //                 }
        
    //             },
    //             error:function(error){
    //                 console.log(error)
    //             }
    //         })
    //             } else {
    //                 swal("Cancelled", "Remove action cancelled", "info");
    //             }
    //         });
           
    //     }
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                document.getElementById("smallQuantits").addEventListener("click", () => {
                    console.log("s");
                    document.getElementById("smallQuantits").classList.add("active");
                    document.getElementById("mediumQuantits").classList.remove("active");
                    document.getElementById("largeQuantits").classList.remove("active");
                });
    
                document.getElementById("mediumQuantits").addEventListener("click", () => {
                    console.log("m");
                    document.getElementById("mediumQuantits").classList.add("active");
                    document.getElementById("largeQuantits").classList.remove("active");
                    document.getElementById("smallQuantits").classList.remove("active");
                });
    
                document.getElementById("largeQuantits").addEventListener("click", () => {
                    console.log("l");
                    document.getElementById("largeQuantits").classList.add("active");
                    document.getElementById("mediumQuantits").classList.remove("active");
                    document.getElementById("smallQuantits").classList.remove("active");
                });
            });
        </script>
        <script>
            
      const addToCarts = (productId) => {
        
        

    let size="";
    if(document.getElementById('smallQuantits').classList.contains('active')){
        size="S";
    }
    else if(document.getElementById('mediumQuantits').classList.contains('active')){
        size="M";
    }
    else if(document.getElementById('largeQuantits').classList.contains('active')){
        size="L";
    }else{
        size="M";
    }
        console.log(productId);
        console.log(size);
        $.ajax({
          url:`/addToCart/${productId}/${size}`,
          method: "POST",
          success: function (response) {
            if (response.status) {
              Toastify({
                text: "Added to Cart",
                duration: 3000,
                gravity: "top", // top or bottom
                position: "center", // left, center or right
                stopOnFocus: true, // Prevents dismissing of toast on hover
                style: {
                  background: "green",
                },
              }).showToast();
              setTimeout(() => {
                location.reload();
              }, 600);
            }
            else {
              Toastify({
                text: `${response.message}`,
                duration: 3000,
                gravity: "top", // top or bottom
                position: "center", // left, center or right
                stopOnFocus: true, // Prevents dismissing of toast on hover
                style: {
                  background: "red",
                },
              }).showToast();
            }
          },
          error: function (XHR, textStatus, errorThrown) {
            console.log(errorThrown);
          },
        });
      };
    </script>
        
        
</body>

</html>