<%- include("../partials/user/user-header") %>
    <main class="main">
     
      <section class="mt-50 mb-50">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="table-responsive container">
                <table
                  class="table shopping-summery text-center clean"
                  id="myTable"
                >
                  <thead>
                    <tr class="main-heading">
                      <th scope="col" class="text-center">Image</th>
                      <th scope="col" class="text-center">Name</th>
                      <th scope="col" class="text-center">Price</th>
                      <th scope="col" class="text-center">Size</th>
                      <th scope="col" class="text-center">Quantity</th>
                      <th scope="col" class="text-center">Subtotal</th>
                      <th scope="col" class="text-center">Remove</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% for( let i = 0; i < products.length; i++ ) { %>
                        <tr>
                            <td class="image product-thumbnail">
                              <img
                                src="/public/uploads/<%= products[i].product.image[0] %>"
                                alt="#"
                              />
                            </td>
                            <td class="product-des product-name">
                              <h5 class="product-name">
                                <a href="shop-product-right.html"
                                  ><%= products[i].product.product_name %></a
                                >
                              </h5>
                              
                            </td>
                            <td class="price" data-title="Price">
                              $<span id="price<%= products[i].product._id %>"><%= products[i].product.offerPrice %></span>
                            </td>
                            <td class="price" data-title="Price">
                              <span><%= products[i].size %></span>
                            </td>
                            <td class="text-center" data-title="Stock">
                              <div class="detail-qty border radius m-auto">
                                
                                <a href="#" class="qty-down" id="quantityDec<%= products[i].product._id %><%= products[i].size %>" onclick="incOrDecQuantity('<%= products[i].product._id %>','-1','<%= products[i].size %>')"
                                  ><i class="fi-rs-angle-small-down" id="quantityDecs<%= products[i].product._id %><%= products[i].size %>"></i
                                ></a>
                               
                                <span class="qty-val" id="quantity<%= products[i].product._id %><%= products[i].size %>"><%= products[i].quantity %></span>
                                
                                  <a href="#" class="qty-up" id="quantityInc<%= products[i].product._id %><%= products[i].size %>" onclick="incOrDecQuantity('<%= products[i].product._id %>','1','<%= products[i].size %>')">
                                      <i class="fi-rs-angle-small-up" id="quantityIncs<%= products[i].product._id %><%= products[i].size %>"></i>
                                  </a>
                              
                              
                                
                              </div>
                            </td>
                            <td class="text-right" data-title="Cart" id="totalSubAmount<%= products[i].product._id %><%= products[i].size %>">
                                
                              $<span><%= products[i].quantity*products[i].product.offerPrice %></span>
                              
                            </td>
                            <td class="action" data-title="Remove">
                              <a onclick="removeFromCart('<%= products[i].product._id %>','<%= products[i].size %>')" class="text-muted"
                                ><i class="fi-rs-trash"></i
                              ></a>
                            </td>
                          </tr>
                          
                    <% } %>
                
                  </tbody>
                </table>
              </div>
              <div class="cart-action text-end pt-15">
                
                <a class="btn" href="/"
                  ><i class="fi-rs-shopping-bag mr-10"></i>Continue Shopping</a
                >
              </div>
              <div class="divider center_icon mt-50 mb-50">
                <i class="fi-rs-fingerprint"></i>
              </div>
              <div class="row mb-50">
                
                <div class="col-lg-6 col-md-12">
                  
                 
                  
                  
                </div>
                <% if (products.length>0) { %>
                  <div class="col-lg-6 col-md-12">
                    <div class="border p-md-4 p-30 border-radius cart-totals">
                      <div class="heading_s1 mb-3">
                        <h4>Cart Totals</h4>
                      </div>
                      <div class="table-responsive">
                        <table class="table">
                          <tbody>
                            <tr>
                              <td class="cart_total_label">Cart Subtotal</td>
                              <td class="cart_total_amount">
                                $<span class="font-lg fw-900 text-brand"
                                   id="cartTotal"><%= totalAmount %></span
                                >
                              </td>
                            </tr>
                            <tr>
                              <td class="cart_total_label">Shipping</td>
                              <td class="cart_total_amount">
                                <i class="ti-gift mr-5"></i> Free Shipping
                              </td>
                            </tr>
                            <tr>
                              <td class="cart_total_label">Total</td>
                              <td class="cart_total_amount">
                                <strong
                                  >$<span class="font-xl fw-900 text-brand"
                                  id="cartTotals"><%= totalAmount %></span
                                  ></strong
                                >
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <a href="/checkout" class="btn">
                        <i class="fi-rs-box-alt mr-10"></i> Proceed To CheckOut</a
                      >
                    </div>
                  </div>
                 
                  <% } %>
                
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer class="main">
      <section class="newsletter p-30 text-white wow fadeIn animated">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-7 mb-md-3 mb-lg-0">
              <div class="row align-items-center">
                <div class="col flex-horizontal-center">
                  <img
                    class="icon-email"
                    src="/public/user/assets/imgs/theme/icons/icon-email.svg"
                    alt=""
                  />
                  <h4 class="font-size-20 mb-0 ml-3">Sign up to Newsletter</h4>
                </div>
                <div class="col my-4 my-md-0 des">
                  <h5 class="font-size-15 ml-4 mb-0">
                    ...and receive
                    <strong>$25 coupon for first shopping.</strong>
                  </h5>
                </div>
              </div>
            </div>
            <div class="col-lg-5">
              <!-- Subscribe Form -->
              <form class="form-subcriber d-flex wow fadeIn animated">
                <input
                  type="email"
                  class="form-control bg-white font-small"
                  placeholder="Enter your email"
                />
                <button class="btn bg-dark text-white" type="submit">
                  Subscribe
                </button>
              </form>
              <!-- End Subscribe Form -->
            </div>
          </div>
        </div>
      </section>
      <section class="section-padding footer-mid">
        <div class="container pt-15 pb-20">
          <div class="row">
            <div class="col-lg-4 col-md-6">
              <div class="widget-about font-md mb-md-5 mb-lg-0">
                <div class="logo logo-width-1 wow fadeIn animated">
                  <a href="index.html"
                    ><img
                      src="/public/user/assets/imgs/theme/logo.svg"
                      alt="logo"
                  /></a>
                </div>
                <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">
                  Contact
                </h5>
                <p class="wow fadeIn animated">
                  <strong>Address: </strong>562 Wellington Road, Street 32, San
                  Francisco
                </p>
                <p class="wow fadeIn animated">
                  <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                </p>
                <p class="wow fadeIn animated">
                  <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                </p>
                <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">
                  Follow Us
                </h5>
                <div
                  class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0"
                >
                  <a href="#"
                    ><img
                      src="/public/user/assets/imgs/theme/icons/icon-facebook.svg"
                      alt=""
                  /></a>
                  <a href="#"
                    ><img
                      src="/public/user/assets/imgs/theme/icons/icon-twitter.svg"
                      alt=""
                  /></a>
                  <a href="#"
                    ><img
                      src="/public/user/assets/imgs/theme/icons/icon-instagram.svg"
                      alt=""
                  /></a>
                  <a href="#"
                    ><img
                      src="/public/user/assets/imgs/theme/icons/icon-pinterest.svg"
                      alt=""
                  /></a>
                  <a href="#"
                    ><img
                      src="/public/user/assets/imgs/theme/icons/icon-youtube.svg"
                      alt=""
                  /></a>
                </div>
              </div>
            </div>
            <div class="col-lg-2 col-md-3">
              <h5 class="widget-title wow fadeIn animated">About</h5>
              <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                <li><a href="#">About Us</a></li>
                <li><a href="#">Delivery Information</a></li>
                <li><a href="#">Privacy Policy</a></li>
                <li><a href="#">Terms &amp; Conditions</a></li>
                <li><a href="#">Contact Us</a></li>
                <li><a href="#">Support Center</a></li>
              </ul>
            </div>
            <div class="col-lg-2 col-md-3">
              <h5 class="widget-title wow fadeIn animated">My Account</h5>
              <ul class="footer-list wow fadeIn animated">
                <li><a href="#">Sign In</a></li>
                <li><a href="#">View Cart</a></li>
                <li><a href="#">My Wishlist</a></li>
                <li><a href="#">Track My Order</a></li>
                <li><a href="#">Help</a></li>
                <li><a href="#">Order</a></li>
              </ul>
            </div>
            <div class="col-lg-4">
              <h5 class="widget-title wow fadeIn animated">Install App</h5>
              <div class="row">
                <div class="col-md-8 col-lg-12">
                  <p class="wow fadeIn animated">
                    From App Store or Google Play
                  </p>
                  <div class="download-app wow fadeIn animated">
                    <a href="#" class="hover-up mb-sm-4 mb-lg-0"
                      ><img
                        class="active"
                        src="/public/user/assets/imgs/theme/app-store.jpg"
                        alt=""
                    /></a>
                    <a href="#" class="hover-up"
                      ><img
                        src="/public/user/assets/imgs/theme/google-play.jpg"
                        alt=""
                    /></a>
                  </div>
                </div>
                <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                  <p class="mb-20 wow fadeIn animated">
                    Secured Payment Gateways
                  </p>
                  <img
                    class="wow fadeIn animated"
                    src="/public/user/assets/imgs/theme/payment-method.png"
                    alt=""
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="container pb-20 wow fadeIn animated">
        <div class="row">
          <div class="col-12 mb-20">
            <div class="footer-bottom"></div>
          </div>
          <div class="col-lg-6">
            <p class="float-md-left font-sm text-muted mb-0">
              &copy; 2022, <strong class="text-brand">Evara</strong> - HTML
              Ecommerce Template
            </p>
          </div>
          <div class="col-lg-6">
            <p class="text-lg-end text-start font-sm text-muted mb-0">
              Designed by
              <a href="http://alithemes.com" target="_blank">Alithemes.com</a>.
              All rights reserved
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
      <div class="preloader d-flex align-items-center justify-content-center">
        <div class="preloader-inner position-relative">
          <div class="text-center">
            <h5 class="mb-5">Now Loading</h5>
            <div class="loader">
              <div class="bar bar1"></div>
              <div class="bar bar2"></div>
              <div class="bar bar3"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Vendor JS-->
    <script src="/public/user/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="/public/user/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="/public/user/assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="/public/user/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="/public/user/assets/js/plugins/slick.js"></script>
    <script src="/public/user/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="/public/user/assets/js/plugins/wow.js"></script>
    <script src="/public/user/assets/js/plugins/jquery-ui.js"></script>
    <script src="/public/user/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="/public/user/assets/js/plugins/magnific-popup.js"></script>
    <script src="/public/user/assets/js/plugins/select2.min.js"></script>
    <script src="/public/user/assets/js/plugins/waypoints.js"></script>
    <script src="/public/user/assets/js/plugins/counterup.js"></script>
    <script src="/public/user/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="/public/user/assets/js/plugins/images-loaded.js"></script>
    <script src="/public/user/assets/js/plugins/isotope.js"></script>
    <script src="/public/user/assets/js/plugins/scrollup.js"></script>
    <script src="/public/user/assets/js/plugins/jquery.vticker-min.js"></script>
    <!-- Template  JS -->
    <script src="./public/user/assets/js/main.js?v=3.4"></script>
    <script src="./public/user/assets/js/shop.js?v=3.4"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script
    type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/toastify-js"
  ></script>
    <script>
      $(document).ready(() => {
        $("#myTable").DataTable();
      });
    </script>
    <script>
      const incOrDecQuantity = (productId, quantity,size) => {
        let OfferPrice=$("#price"+productId).html();
        let quant=$("#quantity"+productId+size).html();
        console.log(OfferPrice)
        console.log(quant)
        $.ajax({
          url: `/updateQuantity?productId=${productId}&quantity=${quantity}&size=${size}`,
          method: "PATCH",
          data:{
            price:OfferPrice
          },
          success: (response) => {
            console.log(response)
            if (response.status) {
              Toastify({
                text: `Quantity Updated`,
                duration: 3000,
                gravity: "top",
                position: "center",
                stopOnFocus: true,
                style: {
                  background: "green",
                },
              }).showToast();
              console.log(response.totalSubAmount)
              document.getElementById("totalSubAmount"+productId+size).innerHTML ="$"+response.totalSubAmount;
              document.getElementById("cartTotal").innerHTML = response.total
              document.getElementById("cartTotals").innerHTML = response.total
              document.getElementById("quantity"+productId+size).innerHTML =response.productQuantity
              document.getElementById('quantityInc'+productId+size).style.display = "block";
              document.getElementById('quantityIncs'+productId+size).style.display = "block";
              document.getElementById('quantityDec'+productId+size).style.display = "block";
              document.getElementById('quantityDecs'+productId+size).style.display = "block";
              
              
              // document.getElementById("totalAmountFinal").innerHTML = "â‚¹" + response.totalAmount
             
                
                
                // $("#quantity" + productId).html(response.cartDetails[0].products.quantity) 
                // $("#individualTotal" + productId).html( response.cartDetails[0].products.totalPrice) 
                // $("#upButton"+productId).show()
            
  
                
            }else if(response.sizeExceed){
              console.log("sjhvjsncvjosjnjno")
              Toastify({
                text: `Stock Limit Exceeded`,
                duration: 3000,
                gravity: "top",
                position: "center",
                stopOnFocus: true,
                style: {
                  background: "red",
                },
              }).showToast();
              document.getElementById("totalSubAmount"+productId+size).innerHTML ="$"+response.totalSubAmount
              document.getElementById("quantity"+productId+size).innerHTML =response.productQuantity
              document.getElementById("cartTotal").innerHTML = response.total
              document.getElementById("cartTotals").innerHTML = response.total
              
              document.getElementById('quantityInc'+productId+size).style.display = "none";
              document.getElementById('quantityIncs'+productId+size).style.display = "none";
            }
              else if(response.sizeLimit){
                
          
              document.getElementById("totalSubAmount"+productId+size).innerHTML ="$"+response.totalSubAmount
              document.getElementById("quantity"+productId+size).innerHTML =response.productQuantity
              document.getElementById("cartTotal").innerHTML = response.total
              document.getElementById("cartTotals").innerHTML = response.total
                
              document.getElementById('quantityDec'+productId+size).style.display = "none";
              document.getElementById('quantityDecs'+productId+size).style.display = "none";


              }
             else {
              Toastify({
                text: `Stock Limit Exceeded`,
                duration: 3000,
                gravity: "top",
                position: "center",
                stopOnFocus: true,
                style: {
                  background: "red",
                },
              }).showToast();
            
              
              $("#quantity" + productId).html(Quantity) 
              $("#upButton"+productId).hide()
            }
  
          }
        })
      }
  
    </script>
    <!-- <script>
      const incOrDecquantity = (productId,quantity,size)=>{
        $.ajax({
          url:`/updateQuantity?productId=${productId}&quantity=${quantity}&size=${size}`,
          method:"patch",
          success: function (response){
            if(response){
              if(response.sizeExceed){
              window.location.reload();
              document.getElementById('quantityInc').style.display = "none";}

              else if(response.sizeLimit){
                window.location.reload();
              document.getElementById('quantityDec').style.display = "none";


              }
              else{
              window.location.reload();
              
            }

            }
            
            
          }
        })
      }
    </script> -->
    <script>
      const removeFromCart = (productId,size)=>{
        console.log(productId)
        console.log(size)
        swal("Are you sure you want to do this?",{
                    buttons:["NO","YES"]
                }).then((res)=>{
                  if(res){
                    $.ajax({
                      
          url:`/removeProduct/${productId}/${size}`,
          method:"DELETE",
          success: function (response){
            if(response.status){
              window.location.reload();

            }
            else{
              window.location.reload();
            }
          }
        })
                  }

                })
        
      }
    </script>
    <!-- <script>
        // Get references to the necessary elements
    const quantityVal = document.querySelector(".qty-val");
    const priceSpan = document.querySelector(".price span");
    const subtotalSpan = document.querySelector(".text-right span");

    // Function to update the subtotal price
    function updateSubtotal() {
      const quantity = parseInt(quantityVal.textContent);
      const price = parseFloat(priceSpan.textContent.replace("$", "")); // Remove dollar sign
      const subtotal = quantity * price;
      subtotalSpan.textContent = `$${subtotal.toFixed(2)}`; // Format with two decimal places
    }

    // Attach event listeners to the quantity buttons
    document.querySelector(".qty-down").addEventListener("click", () => {
      const currentQuantity = parseInt(quantityVal.textContent);
      if (currentQuantity > 1) {
        quantityVal.textContent = currentQuantity - 1;
        updateSubtotal();
      }
    });

    document.querySelector(".qty-up").addEventListener("click", () => {
      const currentQuantity = parseInt(quantityVal.textContent);
      quantityVal.textContent = currentQuantity+1;
      updateSubtotal();
    });

    // Call the update function initially to display the correct subtotal
    updateSubtotal();
    </script> -->

    <!-- <script>
         function updateCart(cartId) {
   
        $.ajax({
          url: "/updateCart/" + cartId,
          type: "get",
        })}
    </script> -->
    
  </body>
</html>
